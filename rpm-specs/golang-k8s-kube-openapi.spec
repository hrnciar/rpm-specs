# Generated by go2rpm
# rounding error on some arch
%ifarch x86_64
%bcond_without check
%endif

# https://github.com/kubernetes/kube-openapi
%global goipath         k8s.io/kube-openapi
%global forgeurl        https://github.com/kubernetes/kube-openapi
%global commit          656914f816f9f6bcb37ec2b40cb7c16fd9084d4c

%gometa

%global common_description %{expand:
Kubernetes OpenAPI spec generation & serving.}

%global golicenses      LICENSE
%global godocs          CONTRIBUTING.md README.md code-of-conduct.md

Name:           %{goname}
Version:        0
Release:        0.7%{?dist}
Summary:        Kubernetes OpenAPI spec generation & serving

# Upstream license specification: Apache-2.0
License:        ASL 2.0
URL:            %{gourl}
Source0:        %{gosource}

BuildRequires:  golang(bitbucket.org/ww/goautoneg)
BuildRequires:  golang(github.com/emicklei/go-restful)
BuildRequires:  golang(github.com/go-openapi/spec)
BuildRequires:  golang(github.com/golang/protobuf/proto)
BuildRequires:  golang(github.com/googleapis/gnostic/compiler)
BuildRequires:  golang(github.com/googleapis/gnostic/openapiv2)
BuildRequires:  golang(github.com/json-iterator/go)
BuildRequires:  golang(github.com/NYTimes/gziphandler)
BuildRequires:  golang(github.com/spf13/pflag)
BuildRequires:  golang(gopkg.in/yaml.v2)
BuildRequires:  golang(k8s.io/gengo/args)
# BuildRequires:  golang(k8s.io/gengo/examples/set-gen/sets)
BuildRequires:  golang(k8s.io/gengo/generator)
BuildRequires:  golang(k8s.io/gengo/namer)
BuildRequires:  golang(k8s.io/gengo/types)
BuildRequires:  golang(k8s.io/klog)
BuildRequires:  golang(sigs.k8s.io/structured-merge-diff/schema)

%if %{with check}
# Tests
BuildRequires:  golang(github.com/davecgh/go-spew/spew)
BuildRequires:  golang(github.com/ghodss/yaml)
BuildRequires:  golang(github.com/google/gofuzz)
BuildRequires:  golang(github.com/onsi/ginkgo)
BuildRequires:  golang(github.com/onsi/ginkgo/config)
BuildRequires:  golang(github.com/onsi/ginkgo/types)
BuildRequires:  golang(github.com/onsi/gomega)
BuildRequires:  golang(github.com/stretchr/testify/assert)
BuildRequires:  golang(k8s.io/gengo/parser)
BuildRequires:  golang(sigs.k8s.io/yaml)
%endif

%description
%{common_description}

%gopkg

%prep
%goprep
sed -i "s|github.com/munnerz/goautoneg|bitbucket.org/ww/goautoneg|" $(find . -name "*.go")
sed -i "s|sigs.k8s.io/structured-merge-diff/v3|sigs.k8s.io/structured-merge-diff|" $(find . -name "*.go")
sed -i "s|k8s.io/klog/v2|k8s.io/klog|" $(find . -name "*.go")

%build
for cmd in cmd/* ; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE
%doc CONTRIBUTING.md README.md code-of-conduct.md pkg/generators/README.md
%{_bindir}/*

%gopkgfiles

%changelog
* Sun Jun 14 16:27:09 CEST 2020 Robert-André Mauchin <zebob.m@gmail.com> - 0-0.7.20200614git656914f
- Bump to commit 656914f816f9f6bcb37ec2b40cb7c16fd9084d4c

* Wed Jan 29 2020 Fedora Release Engineering <releng@fedoraproject.org> - 0-0.6
- Rebuilt for https://fedoraproject.org/wiki/Fedora_32_Mass_Rebuild

* Thu Jul 25 2019 Fedora Release Engineering <releng@fedoraproject.org> - 0-0.5
- Rebuilt for https://fedoraproject.org/wiki/Fedora_31_Mass_Rebuild

* Sat Jul 06 22:40:41 CEST 2019 Robert-André Mauchin <zebob.m@gmail.com> - 0-0.4.20190706gitb3a7cee
- Bump to commit b3a7cee44a305be0a69e1b9ac03018307287e1b0

* Sat Jul 06 21:51:58 CEST 2019 Robert-André Mauchin <zebob.m@gmail.com> - 0-0.3.20190706gita5f05d4
- Bump to commit a5f05d44704602ce36b50a0201a439b616649972

* Sat Jul 06 19:08:03 CEST 2019 Robert-André Mauchin <zebob.m@gmail.com> - 0-0.2.20190706gitdb7b694
- Bump to commit db7b694dc208eead64d38030265f702db593fcf2

* Thu May 09 20:58:52 CEST 2019 Robert-André Mauchin <zebob.m@gmail.com> - 0-0.1.20190509git411b248
- Initial package
