%{?nodejs_find_provides_and_requires}

%global enable_tests 0

Name:       nodejs-express
Version:    3.5.2
Release:    14%{?dist}
Summary:    Sinatra inspired web development framework for Node.js
License:    MIT
URL:        https://github.com/visionmedia/express
Source0:    http://registry.npmjs.org/express/-/express-%{version}.tgz
# The test files are not included in the npm tarball.
# Source1 is generated by running Source10, which pulls from the upstream
# version control repository.
Source1:    tests-%{version}.tar.bz2
Source2:    examples-%{version}.tar.bz2
Source10:   dl-tests.sh

BuildArch:  noarch
%if 0%{?fedora} >= 19
ExclusiveArch: %{nodejs_arches} noarch
%else
ExclusiveArch: %{ix86} x86_64 %{arm} noarch
%endif

BuildRequires:  nodejs-packaging

%if 0%{?enable_tests}
BuildRequires:  npm(buffer-crc32)
BuildRequires:  npm(commander)
BuildRequires:  npm(connect)
BuildRequires:  npm(cookie)
BuildRequires:  npm(cookie-signature)
BuildRequires:  npm(debug)
BuildRequires:  npm(ejs)
BuildRequires:  npm(fresh)
BuildRequires:  npm(jade)
BuildRequires:  npm(marked)
BuildRequires:  npm(merge-descriptors)
BuildRequires:  npm(methods)
BuildRequires:  npm(mkdirp)
BuildRequires:  npm(mocha)
BuildRequires:  npm(range-parser)
BuildRequires:  npm(send)
BuildRequires:  npm(should)
BuildRequires:  npm(stylus)
BuildRequires:  npm(supertest)
%endif

%description
This Node.js module is a fast, minimalist web development framework inspired
by Sinatra.

The Express philosophy is to provide small, robust tooling for HTTP servers.
Making it a great solution for single page applications, web sites, hybrids,
or public HTTP APIs.

Built on Connect you can use only what you need, and nothing more,
applications can be as big or as small as you like, even a single file.
Express does not force you to use any specific ORM or template engine. With
support for over 14 template engines via Consolidate.js you can quickly craft
your perfect framework.


%prep
%setup -q -n package
%setup -q -T -D -a 1 -n package
%setup -q -T -D -a 2 -n package

%nodejs_fixdep commander '>=1.3.2'
%nodejs_fixdep range-parser '~1.0.0'
%nodejs_fixdep mkdirp '~0.3'
%nodejs_fixdep cookie '~0.1.2'
%nodejs_fixdep buffer-crc32 '~0.2.1'
%nodejs_fixdep fresh '~0.2.2'
%nodejs_fixdep methods
%nodejs_fixdep send '~0.3.0'
%nodejs_fixdep cookie-signature '~1.0.3'
%nodejs_fixdep merge-descriptors '^1.0.0'
%nodejs_fixdep debug '^2.2.0'


%build
#nothing to do


%install
mkdir -p %{buildroot}%{nodejs_sitelib}/express
cp -pr package.json index.js lib/ \
    %{buildroot}%{nodejs_sitelib}/express
mkdir -p %{buildroot}%{nodejs_sitelib}/express/bin
install -p -D -m0755 bin/express \
    %{buildroot}%{nodejs_sitelib}/express/bin/express
mkdir -p %{buildroot}%{_bindir}
ln -s %{nodejs_sitelib}/express/bin/express \
    %{buildroot}%{_bindir}/express

%nodejs_symlink_deps


%if 0%{?enable_tests}
%check
%nodejs_symlink_deps --check
rm -f test.js
NODE_ENV=test /usr/bin/mocha --reporter dot \
    --globals setImmediate,clearImmediate --check-leaks
NODE_ENV=test %{nodejs_sitelib}/mocha/bin/mocha --reporter dot --bail \
    test/acceptance/*.js
%endif


%files
%doc History.md LICENSE Readme.md examples/
%{nodejs_sitelib}/express
%{_bindir}/express


%changelog
* Wed Jan 29 2020 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-14
- Rebuilt for https://fedoraproject.org/wiki/Fedora_32_Mass_Rebuild

* Thu Jul 25 2019 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-13
- Rebuilt for https://fedoraproject.org/wiki/Fedora_31_Mass_Rebuild

* Fri Feb 01 2019 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-12
- Rebuilt for https://fedoraproject.org/wiki/Fedora_30_Mass_Rebuild

* Fri Jul 13 2018 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-11
- Rebuilt for https://fedoraproject.org/wiki/Fedora_29_Mass_Rebuild

* Thu Feb 08 2018 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-10
- Rebuilt for https://fedoraproject.org/wiki/Fedora_28_Mass_Rebuild

* Wed Jul 26 2017 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-9
- Rebuilt for https://fedoraproject.org/wiki/Fedora_27_Mass_Rebuild

* Thu Apr 13 2017 Jared Smith <jsmith@fedoraproject.org> - 3.5.2-8
- Relax dependency on npm(methods) to allow this package to build again

* Fri Feb 10 2017 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-7
- Rebuilt for https://fedoraproject.org/wiki/Fedora_26_Mass_Rebuild

* Thu Feb 04 2016 Fedora Release Engineering <releng@fedoraproject.org> - 3.5.2-6
- Rebuilt for https://fedoraproject.org/wiki/Fedora_24_Mass_Rebuild

* Tue Nov 24 2015 Tom Hughes <tom@compton.nu> - 3.5.2-5
- Update npm(debug) dependency

* Thu Jun 18 2015 Tom Hughes <tom@compton.nu> - 3.5.2-4
- Fix version of npm(merge-descriptors) dependency

* Wed Jun 17 2015 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 3.5.2-3
- Rebuilt for https://fedoraproject.org/wiki/Fedora_23_Mass_Rebuild

* Sat Jun 07 2014 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 3.5.2-2
- Rebuilt for https://fedoraproject.org/wiki/Fedora_21_Mass_Rebuild

* Fri Apr 25 2014 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.5.2-1
- update to upstream release 3.5.2

* Sun Apr 20 2014 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.5.1-1
- update to upstream release 3.5.1

* Mon Mar 17 2014 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.5.0-2
- fix versioned dependency on npm(connect)

* Sat Mar 08 2014 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.5.0-1
- update to upstream release 3.5.0

* Mon Aug 26 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.3.5-1
- update to upstream release 3.3.5
- add ExclusiveArch logic

* Sat Aug 03 2013 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 3.3.3-2
- Rebuilt for https://fedoraproject.org/wiki/Fedora_20_Mass_Rebuild

* Fri Jul 05 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.3.3-1
- update to upstream release 3.3.3
- restrict to compatible arches

* Sat May 25 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.2.5-1
- update to upstream release 3.2.5

* Wed Apr 17 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.2.0-1
- update to upstream release 3.2.0

* Mon Apr 15 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.2-1
- update to upstream release 3.1.2

* Mon Apr 15 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-7
- make dependency on npm(cookie-signature) not version specific

* Tue Apr 09 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-6
- make some versioned dependencies even less specific

* Tue Apr 09 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-5
- make all versioned dependencies less specific

* Tue Apr 09 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-4
- fix version of npm(cookie) dependency

* Sat Mar 16 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-3
- add a custom man page

* Wed Feb 20 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-2
- fix version of npm(connect) dependency

* Wed Feb 20 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.1.0-1
- update to upstream release 3.1.0

* Wed Feb 13 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.0.6-2
- make use of %%nodejs_fixdep

* Mon Feb 11 2013 Jamie Nguyen <jamielinux@fedoraproject.org> - 3.0.6-1
- initial package
